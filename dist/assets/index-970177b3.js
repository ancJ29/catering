import{l as i}from"./useTranslation-e97efc14.js";import{r as c,Q as m,S as n}from"./index-344213bf.js";import{u as U,l}from"./index-8981d1d4.js";import{a as r,c as G}from"./index-b822ee52.js";const g=1e3,R=g*60,$=R*60,h=$*24,u=h*7;function E(s){const e=s-s%u-3*h;return e+u>s?e:e+u}function y(s){return s-s%h}function L(s){const e=new Date(y(s));return e.setUTCDate(1),e.getTime()}function N(s){let e=new Date(y(s));return e.setUTCMonth(e.getUTCMonth()+1),e.setUTCDate(1),e=new Date(e.getTime()-g),e.getTime()}function K(s){return E(L(s))}function Q(s){return E(N(s))+u-h}function j({reload:s}={}){const[e,t]=c.useState(new Map),[a,f]=c.useState([]),[_,C]=c.useState([""]);c.useEffect(()=>{e.size&&(C(Array.from(e.keys())),f(Array.from(e.values())))},[e]);const k=c.useCallback(async()=>{if(!e.size&&s){const o=await s();o&&t(new Map(o.map(p=>[p.name,p])))}},[e.size,s]);U(k);const O=c.useCallback(o=>{if(!o){f(Array.from(e.values()));return}const p=o.toLowerCase();f(Array.from(e.values()).filter(w=>{var d;return(d=w.name)==null?void 0:d.toLocaleLowerCase().includes(p)}))},[e]),P=c.useCallback(o=>{i.debug("change",o,e.has(o)),e.has(o)&&f([e.get(o)])},[e]);return{data:a,names:_,records:e,filter:O,change:P,setRecords:t}}const T=m[n.GET_CUSTOMERS].schema.response;T.shape.customers.transform(s=>s[0]);const b=T.omit({cursor:!0,hasMore:!0});async function q(){const s="domain.customer.getAllCustomers";if(r.has(s)){const t=b.safeParse(r.get(s));if(t.success)return i.debug("cache hit",s),t.data.customers}const e=await l({key:"customers",action:n.GET_CUSTOMERS});return r.set(s,{customers:e}),e}const I=m[n.GET_DAILY_MENU].schema.response;I.transform(s=>s[0]);async function J({customerId:s,from:e=Date.now()-u,to:t=Date.now()+u,noCache:a=!1}){return await G({action:n.GET_DAILY_MENU,params:{customerId:s,from:e,to:t},options:{noCache:a}})||[]}const M=m[n.GET_DEPARTMENTS].schema.response;M.shape.departments.transform(s=>s[0]);const z=M.omit({cursor:!0,hasMore:!0});async function V(s){const e="domain.department.getAllDepartments";if(r.has(e)){const a=z.safeParse(r.get(e));if(a.success)return i.debug("cache hit",e),a.data.departments}const t=l({key:"departments",action:n.GET_DEPARTMENTS,params:{type:s},noCache:!0});return r.set(e,{departments:t}),t}const A=m[n.GET_MATERIALS].schema.response;A.shape.materials.transform(s=>s[0]);const Y=A.omit({cursor:!0,hasMore:!0});async function X(s=!1){const e="domain.material.getAllMaterials";if(!s&&r.has(e)){const a=Y.safeParse(r.get(e));if(a.success)return i.debug("cache hit",e),a.data.materials}let t=await l({key:"materials",action:n.GET_MATERIALS});return t=t.map(a=>(a.name=a.name.replace(/\.[0-9]+$/g,""),a)),r.set(e,{materials:t}),t}const S=m[n.GET_PRODUCTS].schema.response;S.shape.products.transform(s=>s[0]);const x=S.omit({cursor:!0,hasMore:!0});async function Z(){const s="domain.product.getAllProducts";if(r.has(s)){const t=x.safeParse(r.get(s));if(t.success)return i.debug("cache hit",s),t.data.products}let e=await l({key:"products",action:n.GET_PRODUCTS});return e=e.map(t=>(t.name=t.name.replace(/\.[0-9]+$/g,""),t)),r.set(s,{products:e}),e}const D=m[n.GET_SUPPLIERS].schema.response;D.shape.suppliers.transform(s=>s[0]);const W=D.omit({cursor:!0,hasMore:!0});async function ee(s){let e=await l({key:"suppliers",action:n.GET_SUPPLIERS,params:{id:s},noCache:!0});return e=e.map(t=>(t.name=t.name.replace(/\.[0-9]+$/g,""),t)),e.length?e[0]:void 0}async function se(s=!1){const e="domain.supplier.getAllSuppliers";if(!s&&r.has(e)){const a=W.safeParse(r.get(e));if(a.success)return i.debug("cache hit",e),a.data.suppliers}let t=await l({key:"suppliers",action:n.GET_SUPPLIERS,take:300});return t=t.map(a=>(a.name=a.name.replace(/\.[0-9]+$/g,""),a)),r.set(e,{suppliers:t}),t}export{u as O,Z as a,ee as b,X as c,V as d,se as e,J as f,q as g,K as h,h as i,Q as l,E as s,j as u};
