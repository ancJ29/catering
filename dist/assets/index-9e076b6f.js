import{C as e,D as A,r as l,a4 as E,W as G,S as P,B as S}from"./index-44f46734.js";import{u as R,D as T,A as U}from"./index-061eed0f.js";import{b as O,u as K}from"./index-cd542a3f.js";import{u as L,F as I}from"./useTranslation-d8fa09dd.js";import{c as W}from"./index-b8fef48f.js";import{u as Y}from"./catering.store-4079f7ed.js";import{u as q}from"./supplier.store-5a179ff2.js";import{N as H}from"./NumberInput-8d624791.js";import{T as k}from"./Text-2cd549b4.js";import{G as b,I as J,a as Q}from"./IconCirclePlus-31916baa.js";import{S as V}from"./Table-f298c8d3.js";import"./createReactComponent-c8129e90.js";import"./Popover-5d48ff7b.js";import"./get-sorted-breakpoints-1570f456.js";const X=(c,a,d)=>[{key:"name",header:c("Catering name"),width:"35%",textAlign:"left",renderCell(n,r){return e.jsx("span",{children:r.name||"-"})}},{key:"address",header:c("Catering address"),width:"35%",renderCell(n,r){return e.jsx("span",{children:(r==null?void 0:r.others.address)||"N/A"})}},{key:"addition-fee",width:"300px",header:c("Supplier catering addition fee"),renderCell(n,r){const o=()=>{const[p,h]=l.useState(r.price||0);return e.jsx(H,{suffix:" Ä‘",step:1e3,onChange:m=>{const u=Z(m);h(u),d((r==null?void 0:r.id)||"",u)},onBlur:()=>{p&&d((r==null?void 0:r.id)||"",p)},thousandSeparator:".",decimalSeparator:",",value:p})};return e.jsx(o,{})}},{key:"remove",style:{flexGrow:1},textAlign:{cell:"right"},renderCell(n,r){return e.jsx(A,{mr:10,size:"compact-xs",onClick:a.bind(null,r.id),children:c("Remove")})}}];function Z(c){let a=parseInt(c.toString().replace(/\./g,"").replace(/,/g,"."));return(isNaN(a)||a<0)&&(a=0),a}const me=()=>{const{reload:c,caterings:a}=Y(),{supplierId:d}=E(),n=L(),{set:r}=q(),[o,p]=l.useState(),[h,m]=l.useState(!1),[u,x]=l.useState([]),[f]=l.useState(new Map),C=l.useCallback(async()=>{var s;if(!d)return;await c();const t=await O(d);t&&(r([t]),p(t),x((s=t.others.caterings)==null?void 0:s.map(i=>{if(a.has(i.cateringId))return{...a.get(i.cateringId),price:i.additionalFee}}).filter(Boolean)))},[d,c,r,a]);R(C);const N=l.useCallback(()=>a.size?Array.from(a.values()):[],[a]),{data:y,records:v,names:z,filter:B,change:F}=K({reload:N}),M=l.useCallback((t,s)=>{m(!0),x(i=>{const g=s.get(t);return g?[...i||[],g]:i})},[]),j=l.useCallback(t=>{m(!0),x(s=>s==null?void 0:s.filter(i=>i.id!==t))},[]),_=l.useMemo(()=>{return X(n,j,t);function t(s,i){f.set(s,i),m(!0)}},[f,j,n]),D=l.useCallback(()=>{G.openConfirmModal({title:n("Update changes"),children:e.jsx(k,{size:"sm",children:n("Are you sure to save changes?")}),labels:{confirm:"OK",cancel:n("Cancel")},onConfirm:async()=>{if(!o)return;const t=o;delete t.others,delete t.id,await W({action:P.UPDATE_SUPPLIER,params:{...t,id:d,others:{...o==null?void 0:o.others,caterings:u.map(s=>({cateringId:s.id,additionalFee:f.get(s.id)??s.price??0}))}},options:{toastMessage:n("Your changes have been saved")}}),m(!1),C()}})},[u,f,C,o,d,n]);return!a.size||!y.length?e.jsx(e.Fragment,{}):e.jsx(S,{children:e.jsxs(S,{w:"100%",pb:10,children:[e.jsxs(I,{w:"100%",align:"center",justify:"space-between",children:[e.jsxs(k,{className:"c-catering-font-bold",size:"2rem",children:[(o==null?void 0:o.name)||"N/A"," - ",n("Supplier supplied catering")]}),e.jsx(A,{disabled:!h,onClick:D,children:n("Save")})]}),e.jsxs(b,{mt:10,children:[e.jsx(b.Col,{span:9,children:v.size&&e.jsx(T,{hasUpdateColumn:!1,hasOrderColumn:!0,columns:_,data:u})}),e.jsxs(b.Col,{span:3,className:"c-catering-bdr-box",children:[e.jsx(U,{mr:10,label:n("Catering name"),onEnter:B,data:z,onChange:F}),e.jsx(V,{h:"80vh",children:y.map(t=>{const s=u.some(g=>g.id===t.id),i=s?J:Q;return e.jsx(S,{style:{cursor:"pointer",borderRadius:"5px"},bg:s?"primary.4":void 0,className:"c-catering-hover-bg",w:"100%",p:10,mb:4,onClick:()=>{s?j(t.id):M(t.id,a)},children:e.jsxs(I,{gap:5,children:[e.jsx(i,{}),e.jsx("span",{style:{fontSize:".8rem"},children:t.name})]})},t.id)})})]})]})]})})};export{me as default};
