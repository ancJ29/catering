import{r,a9 as _e,f as le,c as de,a2 as ue,z as ye,R as T,aa as we,ab as Ae,g as ve,t as Ce,ac as Ne,ad as ze,B as I,v as je,ae as We,x as oe,y as Me,w as re,d as Ve,a0 as Fe,af as Ge,Q as Oe,S as Re,C as e,D as Be,U as ie,W as Ue,_ as Le,V as Ye,ag as He}from"./index-44f46734.js";import{D as Ke,A as Se,S as qe,u as Qe}from"./index-061eed0f.js";import{u as me,F as K,l as Je}from"./useTranslation-d8fa09dd.js";import{u as Xe,O as Q,g as Ze,a as et,f as tt,s as nt,h as st,i as ne,l as at}from"./index-cd542a3f.js";import{d as ce,c as ot}from"./index-b8fef48f.js";import{s as rt}from"./event-8c96bde5.js";import{G as ae,I as ke,a as it}from"./IconCirclePlus-31916baa.js";import{S as ct,T as A}from"./Table-f298c8d3.js";import{T as he}from"./Text-2cd549b4.js";import{u as lt}from"./use-disclosure-2e496f2b.js";import{n as dt,c as Te}from"./createReactComponent-c8129e90.js";import{S as ut}from"./Stack-4c9ab219.js";import"./Popover-5d48ff7b.js";import"./get-sorted-breakpoints-1570f456.js";function mt(){return typeof process<"u"&&process.env?"production":"development"}const ht={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function pt(){const t=r.useRef(0),n=r.useRef(null),[s,l]=r.useState(ht),o=r.useMemo(()=>typeof window<"u"?new ResizeObserver(h=>{const p=h[0];p&&(cancelAnimationFrame(t.current),t.current=requestAnimationFrame(()=>{n.current&&l(p.contentRect)}))}):null,[]);return r.useEffect(()=>(n.current&&(o==null||o.observe(n.current)),()=>{o==null||o.disconnect(),t.current&&cancelAnimationFrame(t.current)}),[n.current]),[n,s]}function ft(t,n,s={autoInvoke:!1}){const l=r.useRef(null),o=r.useCallback((...p)=>{l.current||(l.current=window.setTimeout(()=>{t(p),l.current=null},n))},[n]),h=r.useCallback(()=>{l.current&&(window.clearTimeout(l.current),l.current=null)},[]);return r.useEffect(()=>(s.autoInvoke&&o(),h),[h,o]),{start:o,clear:h}}const[gt,vt]=_e(),bt={},pe=le((t,n)=>{const{value:s,defaultValue:l,onChange:o,size:h,wrapperProps:p,children:x,name:g,...M}=de("RadioGroup",bt,t),R=ue(g),[S,C]=ye({value:s,defaultValue:l,finalValue:"",onChange:o}),P=i=>C(i.currentTarget.value);return T.createElement(gt,{value:{value:S,onChange:P,size:h,name:R}},T.createElement(we.Wrapper,{size:h,ref:n,...p,...M,labelElement:"div",__staticSelector:"RadioGroup"},T.createElement(Ae,{role:"radiogroup"},x)))});pe.classes=we.Wrapper.classes;pe.displayName="@mantine/core/RadioGroup";function xt({size:t,style:n,...s}){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 5 5",style:{width:ve(t),height:ve(t),...n},"aria-hidden":!0,...s},T.createElement("circle",{cx:"2.5",cy:"2.5",r:"2.5",fill:"currentColor"}))}var $e={root:"m-f3f1af94",inner:"m-89c4f5e4",icon:"m-f3ed6b2b",radio:"m-8a3dbb89","radio--outline":"m-1bfe9d39"};const yt={labelPosition:"right"},wt=je((t,{size:n,radius:s,color:l,iconColor:o,variant:h})=>{const p=We({color:l||t.primaryColor,theme:t}),x=p.isThemeColor&&p.shade===void 0?`var(--mantine-color-${p.color}-outline)`:p.color;return{root:{"--radio-size":oe(n,"radio-size"),"--radio-radius":s===void 0?void 0:Me(s),"--radio-color":h==="outline"?x:re(l,t),"--radio-icon-color":o?re(o,t):void 0,"--radio-icon-size":oe(n,"radio-icon-size")}}}),J=le((t,n)=>{const s=de("Radio",yt,t),{classNames:l,className:o,style:h,styles:p,unstyled:x,vars:g,id:M,size:R,label:S,labelPosition:C,description:P,error:i,radius:f,color:v,variant:$,disabled:d,wrapperProps:X,icon:Y=xt,rootRef:z,iconColor:Z,onChange:W,...G}=s,k=Ce({name:"Radio",classes:$e,props:s,className:o,style:h,classNames:l,styles:p,unstyled:x,vars:g,varsResolver:wt}),y=vt(),q=(y==null?void 0:y.size)??R,H=s.size?R:q,{styleProps:D,rest:F}=Ne(G),V=ue(M),m=y?{checked:y.value===F.value,name:F.name??y.name,onChange:u=>{y.onChange(u),W==null||W(u)}}:{};return T.createElement(ze,{...k("root"),__staticSelector:"Radio",__stylesApiProps:s,id:V,size:H,labelPosition:C,label:S,description:P,error:i,disabled:d,classNames:l,styles:p,unstyled:x,"data-checked":m.checked||void 0,variant:$,ref:z,...D,...X},T.createElement(I,{...k("inner"),mod:{"label-position":C}},T.createElement(I,{...k("radio",{focusable:!0,variant:$}),onChange:W,...F,...m,component:"input",mod:{error:!!i},ref:n,id:V,disabled:d,type:"radio"}),T.createElement(Y,{...k("icon"),"aria-hidden":!0})))});J.classes=$e;J.displayName="@mantine/core/Radio";J.Group=pe;function se(t,n){const s=parseFloat(t.replace("px",""));return Number.isNaN(s)?n:s}function Ct(t,n){const s=window.getComputedStyle(t);return{top:se(s.getPropertyValue("padding-top"),n),right:se(s.getPropertyValue("padding-right"),n),bottom:se(s.getPropertyValue("padding-bottom"),n),left:se(s.getPropertyValue("padding-left"),n)}}var Ee={root:"m-cf365364",indicator:"m-9e182ccd",label:"m-1738fcb2",input:"m-1714d588",control:"m-69686b9b"};const jt=4,Mt={},Rt=je((t,{radius:n,color:s,transitionDuration:l,size:o,transitionTimingFunction:h})=>({root:{"--sc-radius":n===void 0?void 0:Me(n),"--sc-color":s?re(s,t):void 0,"--sc-shadow":s?void 0:"var(--mantine-shadow-xs)","--sc-transition-duration":l===void 0?void 0:`${l}ms`,"--sc-transition-timing-function":h,"--sc-padding":oe(o,"sc-padding"),"--sc-font-size":Ge(o)}})),fe=le((t,n)=>{var w,_;const s=de("SegmentedControl",Mt,t),{classNames:l,className:o,style:h,styles:p,unstyled:x,vars:g,data:M,value:R,defaultValue:S,onChange:C,size:P,name:i,disabled:f,readOnly:v,fullWidth:$,orientation:d,radius:X,color:Y,transitionDuration:z,transitionTimingFunction:Z,variant:W,...G}=s,k=Ce({name:"SegmentedControl",props:s,classes:Ee,className:o,style:h,classNames:l,styles:p,unstyled:x,vars:g,varsResolver:Rt}),{dir:y}=dt(),q=Ve(),H=M.map(a=>typeof a=="string"?{label:a,value:a}:a),[D,F]=ye({value:R,defaultValue:S,finalValue:Array.isArray(M)?((w=H.find(a=>!a.disabled))==null?void 0:w.value)??((_=M[0])==null?void 0:_.value)??null:null,onChange:C}),[V,m]=r.useState({width:0,height:0,translate:[0,0]}),u=ue(i),c=r.useRef({}),j=r.useRef(null),[E,O]=r.useState(!1),[N,B]=pt();r.useEffect(()=>{if(D in c.current&&N.current){const a=c.current[D];if(a){const b=Ct(j.current,jt),U=a.getBoundingClientRect(),L=a.offsetWidth/U.width,ge=a.clientWidth*L||0,Ie=a.clientHeight*L||0,Pe=B.width-a.parentElement.offsetLeft+(y==="rtl"?b.left:b.right)-ge,De=a.parentElement.offsetLeft-(y==="rtl"?b.right:b.left);m({width:ge,height:Ie,translate:[y==="rtl"?Pe*-1:De,a.parentElement.offsetTop-b.top]})}else m({width:0,height:0,translate:[0,0]})}},[D,B,y]),ft(()=>{mt()!=="test"&&O(!0)},20,{autoInvoke:!0});const ee=H.map(a=>T.createElement(I,{...k("control"),mod:{active:D===a.value,orientation:d},key:a.value},T.createElement("input",{...k("input"),disabled:f||a.disabled,type:"radio",name:u,value:a.value,id:`${u}-${a.value}`,checked:D===a.value,onChange:()=>!v&&F(a.value),"data-focus-ring":q.focusRing}),T.createElement(I,{component:"label",...k("label"),mod:{active:D===a.value&&!(f||a.disabled),disabled:f||a.disabled,"read-only":v},htmlFor:`${u}-${a.value}`,ref:b=>{c.current[a.value]=b},__vars:{"--sc-label-color":Y!==void 0?"var(--mantine-color-white)":void 0}},a.label))),te=Fe(N,j,n);return M.length===0?null:T.createElement(I,{...k("root"),variant:W,size:P,ref:te,mod:{"full-width":$,orientation:d,initialization:!E},...G,role:"radiogroup"},typeof D=="string"&&T.createElement(I,{component:"span",...k("indicator"),__vars:{"--sc-indicator-width":`${V.width}px`,"--sc-indicator-height":`${V.height}px`,"--sc-indicator-transform":`translate(${V.translate[0]}px, ${V.translate[1]}px)`}}),ee)});fe.classes=Ee;fe.displayName="@mantine/core/SegmentedControl";var St=Te("chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]),kt=Te("chevron-right","IconChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]);Oe[Re.GET_CUSTOMERS].schema.response.shape.customers.transform(t=>t[0].others.targets).transform(t=>t[0]);const be=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Tt=(t,n)=>[{key:"typeName",header:t("Product type"),width:"15%"},{key:"name",header:t("Cuisine name"),width:"35%",renderCell(s,l){return e.jsxs(K,{justify:"space-between",pr:"2rem",children:[e.jsx(he,{children:l.name}),e.jsx(ie,{onClick:n.bind(null,l.id),children:e.jsx(ke,{className:"c-catering-btn-icon"})})]})}},{key:"costPrice",header:t("Cost price"),width:"10%",renderCell(){return"-"}},{key:"avgCostPrice",header:t("Average cost price"),width:"10%",renderCell(){return"-"}},{key:"ratio",header:t("Ratio"),width:"10%",renderCell(){return"-"}}],$t=({allProducts:t,productIds:n,onSave:s})=>{const l=me(),[o,h]=r.useState(n),p=r.useMemo(()=>o.map(f=>t.get(f)).filter(Boolean),[t,o]),x=r.useCallback(f=>{h(v=>[...v,f])},[]),g=r.useCallback(f=>{h(v=>v.filter($=>$!==f))},[]),M=r.useMemo(()=>Tt(l,g),[g,l]),{names:R,data:S,change:C,filter:P}=Xe({reload:()=>new Promise(f=>f(Array.from(t.values())))}),i=r.useMemo(()=>{const f=n.sort().join(","),v=o.sort().join(",");return f!==v},[n,o]);return e.jsxs(I,{children:[e.jsx(I,{w:"100%",ta:"right",pb:10,children:e.jsx(Be,{disabled:!i,onClick:s.bind(null,o),children:l("Save")})}),e.jsxs(ae,{mt:10,children:[e.jsxs(ae.Col,{span:8,children:[e.jsx(Ke,{hasUpdateColumn:!1,hasOrderColumn:!0,columns:M,data:p}),e.jsx(I,{h:"20vh",className:"c-catering-bdr-box",p:8,children:"TODO: Detail prices"})]}),e.jsxs(ae.Col,{span:4,className:"c-catering-bdr-box",children:[e.jsx(K,{justify:"end",align:"center",mb:"1rem",children:e.jsx(Se,{w:"20vw",onEnter:P,data:R,onChange:C})}),e.jsx(ct,{h:"80vh",children:S.map(f=>{const v=o.includes(f.id),$=v?ke:it;return e.jsx(I,{style:{cursor:"pointer",borderRadius:"5px"},bg:v?"primary.4":void 0,className:"c-catering-hover-bg",w:"100%",p:10,mb:4,onClick:()=>{v?g(f.id):x(f.id)},children:e.jsxs(K,{gap:5,children:[e.jsx($,{}),e.jsxs(he,{children:[f.name," (",f.code,")"]})]})},f.id)})})]})]})]})},Et=({product:t})=>t?e.jsx(I,{w:"100%",fz:10,fw:900,c:"white",pl:8,mt:4,bg:"teal.6",style:{userSelect:"none",borderRadius:"5px"},children:(t==null?void 0:t.name)||"--"}):e.jsx(e.Fragment,{}),xe=({targetName:t,allProducts:n,shift:s,date:l,timestamp:o,customer:h,productIds:p,onReload:x})=>{const g=me(),[M,{open:R,close:S}]=lt(!1),C=r.useMemo(()=>h?`${ce(o).format("YYYY-MM-DD")}: ${h.name} > ${t} > ${s}`:"",[h,s,t,o]),P=r.useCallback(i=>{if(!o||!h){S();return}Ue.openConfirmModal({title:`${g("Update menu")}`,children:e.jsx(he,{size:"sm",children:g("Are you sure you want to save menu?")}),labels:{confirm:"OK",cancel:g("Cancel")},onConfirm:async()=>{await ot({action:Re.PUSH_DAILY_MENU,params:{date:new Date(o),targetName:t,shift:s,customerId:h.id||"",productIds:i}}),S(),x()}})},[o,h,g,S,t,s,x]);return h?e.jsxs(A.Td,{onClick:R,height:150,style:{cursor:"pointer",verticalAlign:"top"},children:[e.jsx(I,{fz:16,fw:900,mb:2,w:"100%",ta:"right",children:l}),p.map((i,f)=>e.jsx(Et,{product:n.get(i)},f)),e.jsx(Le,{opened:M,onClick:rt,onClose:S,title:C,fullScreen:!0,classNames:{title:"c-catering-font-900 c-catering-fz-2rem c-catering-text-main"},children:e.jsx($t,{productIds:p,allProducts:n,onSave:P})})]}):e.jsx(e.Fragment,{})},Lt=()=>{const{enumMap:t}=Ye(),n=me(),[s,l]=r.useState("W"),[o,h]=r.useState(Date.now()),[[p,x]]=r.useState([n("Weekly"),n("Monthly")]),[g,M]=r.useState(new Map),[R,S]=r.useState(new Map),[C,P]=r.useState(new Map),[i,f]=r.useState(),[v,$]=r.useState(),[d,X]=r.useState(),Y=r.useCallback(m=>{if(g!=null&&g.has(m)){const u=g.get(m),c=u==null?void 0:u.others.targets[0];X(u),f(c),$(c==null?void 0:c.shifts[0])}},[g]),z=r.useMemo(()=>d==null?void 0:d.others.targets.map(m=>m.name),[d]),Z=r.useCallback(m=>{if(m&&z!=null&&z.includes(m)){const u=d==null?void 0:d.others.targets.find(c=>c.name===m);f(u),$(u==null?void 0:u.shifts[0])}},[z,d]),W=r.useCallback(m=>{l(m===p?"W":"M")},[p]),G=r.useCallback((m=-1)=>{h(s==="W"?u=>u+m*Q:u=>{const c=new Date(u);return c.setMonth(c.getMonth()+m),c.getTime()})},[s]),k=r.useCallback(()=>{Promise.all([Ze(),et()]).then(([m,u])=>{M(new Map(m.map(c=>[c.name,c]))),S(new Map(u.map(c=>{const j=t.get(c.type);if(c.typeName=j?n(j):`${j}.s`,typeof c.name=="string"){const E=c.name.split(".");c.name=E.length>1?E.slice(0,-1).join("."):E[0]}return[c.id,c]})))})},[t,n]),y=r.useCallback((m=!1)=>{d!=null&&d.id&&tt({noCache:m,customerId:d==null?void 0:d.id,from:o-4*Q,to:o+4*Q}).then(u=>{P(c=>(u.forEach(j=>{const{targetName:E,shift:O}=j.others,N=j.date.getTime(),B=`${j.customerId}.${E}.${O}.${N}`;c.set(B,j)}),new Map(c)))})},[o,d]),{monthView:q,weekView:H,headers:D}=r.useMemo(()=>{var ee,te;let m=e.jsx(e.Fragment,{}),u=e.jsx(e.Fragment,{}),c=[[]],j=be.map(w=>({label:n(w)}));const E=new Map,O=s==="W",N=O?nt(o):st(o),B=O?N+6*ne:at(o);if(i)for(let w=N;w<=B;w+=ne)for(const _ of i.shifts){const a=`${d==null?void 0:d.id}.${i.name}.${_}.${new Date(w).getTime()}`;if(Je.debug("dailyMenu has key",a,C.has(a)),C.has(a)){const b=C.get(a),U=(te=(ee=b==null?void 0:b.menu)==null?void 0:ee.menuProducts)==null?void 0:te.map(L=>L.product.id);E.set(a,U||[]);continue}}if(O)j=be.map((w,_)=>{const a=N+_*ne;return{label:`${ce(a).format("DD/MM")} (${n(w)})`,timestamp:a}}),m=e.jsx(A.Tbody,{children:i==null?void 0:i.shifts.map((w,_)=>e.jsxs(A.Tr,{children:[e.jsx(A.Td,{children:w}),j.map((a,b)=>e.jsx(xe,{onReload:y.bind(null,!0),allProducts:R,targetName:i.name,shift:w,customer:d,timestamp:a.timestamp,productIds:E.get(`${d==null?void 0:d.id}.${i.name}.${w}.${a.timestamp||0}`)||[]},b))]},_))});else{const w=Math.round((B-N)/Q);c=Array.from({length:w},(_,a)=>["T2","T3","T4","T5","T6","T7","CN"].map((b,U)=>{const L=N+a*Q+U*ne;return{timestamp:L,date:ce(L).format("DD/MM")}})),u=e.jsx(A.Tbody,{children:c.map((_,a)=>e.jsx(A.Tr,{children:_.map((b,U)=>e.jsx(xe,{onReload:k,allProducts:R,targetName:(i==null?void 0:i.name)||"",shift:v||"",customer:d,date:b.date,timestamp:b.timestamp,productIds:E.get(`${d==null?void 0:d.id}.${i==null?void 0:i.name}.${v}.${b.timestamp}`)||[]},U))},a))})}return{rows:c,headers:j,menuItemsByDate:E,weekView:m,monthView:u}},[s,o,i,n,d,C,y,R,k,v]),F=r.useMemo(()=>Array.from((g==null?void 0:g.keys())||[]),[g]),V=r.useMemo(()=>{var m;return e.jsxs(K,{gap:10,w:"100%",justify:"space-between",align:"end",children:[e.jsxs(K,{gap:10,justify:"start",align:"start",children:[e.jsx(Se,{label:n("Customer"),data:F,onChange:Y}),e.jsx(qe,{value:i==null?void 0:i.name,label:n("Customer target"),data:z,onChange:Z}),s==="M"&&((m=i==null?void 0:i.shifts)==null?void 0:m.length)&&e.jsx(J.Group,{label:n("shifts"),value:v,onChange:$,children:e.jsx(He,{children:i==null?void 0:i.shifts.map((u,c)=>e.jsx(J,{disabled:i.shifts.length===1,h:"2.2rem",pt:".8rem",value:u,label:u},c))})})]}),e.jsxs(K,{justify:"center",align:"center",children:[e.jsx(ie,{onClick:G.bind(null,-1),children:e.jsx(St,{className:"c-catering-btn-icon"})}),e.jsx(fe,{value:s==="W"?p:x,data:[p,x],onChange:W}),e.jsx(ie,{onClick:G.bind(null,1),children:e.jsx(kt,{className:"c-catering-btn-icon"})})]})]})},[x,p,Y,Z,W,G,F,s,v,n,i,z]);return r.useEffect(y,[y]),Qe(k),e.jsxs(ut,{gap:10,children:[V,e.jsxs(A,{withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(A.Thead,{children:e.jsxs(A.Tr,{children:[s==="W"&&e.jsx(A.Th,{w:60,children:" "}),D.map((m,u)=>e.jsx(A.Th,{ta:"center",children:m.label},u))]})}),s==="W"?H:q]})]})};export{Lt as default};
