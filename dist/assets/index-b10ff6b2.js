import{C as t,D as N,r as o,a4 as X,V as Y,X as H,W as J,S as Q,B as b}from"./index-344213bf.js";import{u as Z,D as ee,S as $,A as re}from"./index-8981d1d4.js";import{b as te,u as ae}from"./index-970177b3.js";import{u as se,F as j}from"./useTranslation-e97efc14.js";import{c as ne}from"./index-b822ee52.js";import{u as ie}from"./material.store-4d353e04.js";import{u as oe}from"./supplier.store-70329809.js";import{u as P}from"./array-59786a0a.js";import{N as le}from"./NumberInput-c7b98c1d.js";import{T}from"./Text-bc00d881.js";import{G as I,I as ce}from"./IconCirclePlus-0cf0926b.js";import{S as ue}from"./Table-07bffc10.js";import{I as pe}from"./IconCircleMinus-0b75dc2d.js";import"./createReactComponent-9318f0fb.js";import"./Popover-378390b2.js";import"./get-sorted-breakpoints-92247a0e.js";const de=(p,r,g,x)=>[{key:"name",header:r("Material name"),width:"35%",textAlign:"left",renderCell(h,s){return t.jsx("span",{children:s.material.name})}},{key:"price",header:r("Material price"),width:"10%",textAlign:"left",renderCell(h,s){const n=()=>{const[c,l]=o.useState(s.price);return t.jsx(le,{suffix:" đ",step:1e3,onChange:d=>{const f=z(d);l(f),x(s.material.id,z(f))},thousandSeparator:".",decimalSeparator:",",value:c})};return t.jsx(n,{})}},{key:"unit",header:r("Material unit"),width:"10%",textAlign:"center",renderCell:(h,s)=>{var c,l;const n=g.get(s.material.id);return((l=(c=n==null?void 0:n.others)==null?void 0:c.unit)==null?void 0:l.name)||"N/A"}},{key:"type",header:r("Material type"),width:"15%",textAlign:"center",renderCell:(h,s)=>{var d;const n=g.get(s.material.id);if(!((d=n==null?void 0:n.others)!=null&&d.type))return"N/A";const c=n.others.type,l=r(`materials.type.${c}`);return t.jsx("span",{children:`${l} (${c})`})}},{key:"group",header:r("Material group"),width:"15%",textAlign:"center",renderCell:(h,s)=>{var d;const n=g.get(s.material.id);if(!((d=n==null?void 0:n.others)!=null&&d.type))return(n==null?void 0:n.name)||"N/A";const c=n.others.group,l=r(`materials.group.${c}`);return t.jsx("span",{children:`${l} (${c})`})}},{key:"remove",style:{flexGrow:1},renderCell(h,s){return t.jsx(N,{mr:10,size:"compact-xs",onClick:p.bind(null,s.material.id),children:r("Remove")})}}];function z(p){let r=parseInt(p.toString().replace(/\./g,"").replace(/,/g,"."));return(isNaN(r)||r<0)&&(r=0),r}const Ne=()=>{const{supplierId:p}=X(),r=se(),{set:g}=oe(),{materialGroupByType:x}=Y(),{reload:h,materials:s}=ie(),[n,c]=o.useState(),[l]=o.useState(new Map),[d,f]=o.useState(!1),[m,M]=o.useState(),[C,S]=o.useState(""),[u,_]=o.useState(""),[G,O]=o.useMemo(()=>{const e=P(Array.from(s.values()).map(i=>i.others.type)).map(i=>({label:r(`materials.type.${i}`),value:i}));let a=[];return u?u in x&&(a=x[u].map(i=>({label:r(`materials.group.${i}`),value:i}))):a=P(Array.from(s.values()).map(i=>i.others.group)).map(i=>({label:r(`materials.group.${i}`),value:i})),[a,e]},[s,u,x,r]),A=o.useCallback(async()=>{if(!p)return;h();const e=await te(p);e&&(g([e]),c(e),M((e==null?void 0:e.supplierMaterials.map(a=>({price:a.price,material:{id:a.material.id,name:a.material.name}})))||[]))},[p,g,h]);Z(A);const D=o.useCallback(()=>s.size?Array.from(s.values()):[],[s]),{data:w,records:E,names:R,filter:k,change:B}=ae({reload:D}),F=o.useCallback((e,a)=>{f(!0),M(i=>{const y=a.get(e);return y?[...i||[],{price:0,material:{id:y.id,name:y.name}}]:i})},[]),U=o.useMemo(()=>w.filter(e=>!(C&&e.others.group!==C||u&&e.others.type!==u)),[w,C,u]),v=o.useCallback(e=>{f(!0),M(a=>a==null?void 0:a.filter(i=>i.material.id!==e))},[]),L=o.useMemo(()=>{return s.size?de(v,r,s,e):[];function e(a,i){f(!0),l.set(a,i)}},[s,l,v,r]),q=o.useCallback(()=>{if(m!=null&&m.some(e=>e.price<=0&&!l.get(e.material.id))){H.show({color:"red.5",message:r("Please input price for all materials")});return}J.openConfirmModal({title:r("Update changes"),children:t.jsx(T,{size:"sm",children:r("Are you sure to save changes?")}),labels:{confirm:"OK",cancel:r("Cancel")},onConfirm:async()=>{if(!m)return;const e=await ne({action:Q.UPDATE_SUPPLIER_MATERIAL,params:{supplierId:p,materials:m.map(a=>({materialId:a.material.id,price:l.get(a.material.id)??a.price}))},options:{toastMessage:r("Your changes have been saved")}});e!=null&&e.success&&A(),f(!1)}})},[A,m,l,p,r]),K=o.useCallback(e=>{_(a=>a!==e?(S(""),e||""):a)},[]),V=o.useCallback(()=>{S(""),_(""),k(""),f(!1)},[k]);return!m||!w.length?t.jsx(t.Fragment,{}):t.jsx(b,{children:t.jsxs(b,{w:"100%",pb:10,children:[t.jsxs(j,{w:"100%",align:"center",justify:"space-between",children:[t.jsxs(T,{className:"c-catering-font-bold",size:"2rem",children:[(n==null?void 0:n.name)||"N/A"," - ",r("Supplier supplied material")]}),t.jsx(N,{disabled:!d,onClick:q,children:r("Save")})]}),t.jsxs(I,{mt:10,children:[t.jsx(I.Col,{span:9,children:E.size&&t.jsx(ee,{hasUpdateColumn:!1,hasOrderColumn:!0,columns:L,data:m})}),t.jsxs(I.Col,{span:3,className:"c-catering-bdr-box",children:[t.jsx(j,{justify:"end",align:"center",mb:"1rem",children:t.jsx($,{value:u,label:r("Material type"),w:"20vw",options:O,onChange:K},u)}),u&&t.jsx(j,{justify:"end",align:"center",mb:"1rem",children:t.jsx($,{label:r("Material group"),value:C,w:"20vw",options:G,onChange:S},u)}),t.jsx(j,{justify:"end",align:"center",mb:"1rem",children:t.jsx(re,{label:r("Material name"),w:"20vw",onEnter:k,data:R,onChange:B})}),t.jsx(b,{ta:"right",children:t.jsx(N,{disabled:!u,onClick:V,children:r("Clear")})}),t.jsx(ue,{h:"80vh",children:U.map(e=>{const a=m.some(W=>W.material.id===e.id),i=e.others.type,y=a?pe:ce;return t.jsx(b,{style:{cursor:"pointer",borderRadius:"5px"},bg:a?"primary.4":void 0,className:"c-catering-hover-bg",w:"100%",p:10,mb:4,onClick:()=>{a?v(e.id):F(e.id,s)},children:t.jsxs(j,{gap:5,children:[t.jsx(y,{}),t.jsxs("span",{style:{fontSize:".8rem"},children:[e.name," ",t.jsxs("span",{children:["(",r(`materials.type.${i}`),")"]})]})]})},e.id)})})]})]})]})})};export{Ne as default};
