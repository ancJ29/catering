import{C as t,D as N,r as o,a4 as X,V as Y,X as H,W as J,S as Q,B as b}from"./index-44f46734.js";import{u as Z,D as ee,S as $,A as re}from"./index-061eed0f.js";import{b as te,u as ae}from"./index-cd542a3f.js";import{u as se,F as j}from"./useTranslation-d8fa09dd.js";import{c as ne}from"./index-b8fef48f.js";import{u as ie}from"./material.store-857bc231.js";import{u as oe}from"./supplier.store-5a179ff2.js";import{u as P}from"./array-59786a0a.js";import{N as le}from"./NumberInput-8d624791.js";import{T}from"./Text-2cd549b4.js";import{G as I,I as ce,a as ue}from"./IconCirclePlus-31916baa.js";import{S as pe}from"./Table-f298c8d3.js";import"./createReactComponent-c8129e90.js";import"./Popover-5d48ff7b.js";import"./get-sorted-breakpoints-1570f456.js";const de=(p,r,g,x)=>[{key:"name",header:r("Material name"),width:"35%",textAlign:"left",renderCell(h,a){return t.jsx("span",{children:a.material.name})}},{key:"price",header:r("Material price"),width:"10%",textAlign:"left",renderCell(h,a){const s=()=>{const[c,l]=o.useState(a.price);return t.jsx(le,{suffix:" đ",step:1e3,onChange:d=>{const f=z(d);l(f),x(a.material.id,z(f))},thousandSeparator:".",decimalSeparator:",",value:c})};return t.jsx(s,{})}},{key:"unit",header:r("Material unit"),width:"10%",textAlign:"center",renderCell:(h,a)=>{var c,l;const s=g.get(a.material.id);return((l=(c=s==null?void 0:s.others)==null?void 0:c.unit)==null?void 0:l.name)||"N/A"}},{key:"type",header:r("Material type"),width:"15%",textAlign:"center",renderCell:(h,a)=>{var d;const s=g.get(a.material.id);if(!((d=s==null?void 0:s.others)!=null&&d.type))return"N/A";const c=s.others.type,l=r(`materials.type.${c}`);return t.jsx("span",{children:`${l} (${c})`})}},{key:"group",header:r("Material group"),width:"15%",textAlign:"center",renderCell:(h,a)=>{var d;const s=g.get(a.material.id);if(!((d=s==null?void 0:s.others)!=null&&d.type))return(s==null?void 0:s.name)||"N/A";const c=s.others.group,l=r(`materials.group.${c}`);return t.jsx("span",{children:`${l} (${c})`})}},{key:"remove",style:{flexGrow:1},renderCell(h,a){return t.jsx(N,{mr:10,size:"compact-xs",onClick:p.bind(null,a.material.id),children:r("Remove")})}}];function z(p){let r=parseInt(p.toString().replace(/\./g,"").replace(/,/g,"."));return(isNaN(r)||r<0)&&(r=0),r}const Ie=()=>{const{supplierId:p}=X(),r=se(),{set:g}=oe(),{materialGroupByType:x}=Y(),{reload:h,materials:a}=ie(),[s,c]=o.useState(),[l]=o.useState(new Map),[d,f]=o.useState(!1),[m,M]=o.useState(),[C,S]=o.useState(""),[u,_]=o.useState(""),[G,O]=o.useMemo(()=>{const e=P(Array.from(a.values()).map(i=>i.others.type)).map(i=>({label:r(`materials.type.${i}`),value:i}));let n=[];return u?u in x&&(n=x[u].map(i=>({label:r(`materials.group.${i}`),value:i}))):n=P(Array.from(a.values()).map(i=>i.others.group)).map(i=>({label:r(`materials.group.${i}`),value:i})),[n,e]},[a,u,x,r]),A=o.useCallback(async()=>{if(!p)return;h();const e=await te(p);e&&(g([e]),c(e),M((e==null?void 0:e.supplierMaterials.map(n=>({price:n.price,material:{id:n.material.id,name:n.material.name}})))||[]))},[p,g,h]);Z(A);const D=o.useCallback(()=>a.size?Array.from(a.values()):[],[a]),{data:w,records:E,names:R,filter:k,change:B}=ae({reload:D}),F=o.useCallback((e,n)=>{f(!0),M(i=>{const y=n.get(e);return y?[...i||[],{price:0,material:{id:y.id,name:y.name}}]:i})},[]),U=o.useMemo(()=>w.filter(e=>!(C&&e.others.group!==C||u&&e.others.type!==u)),[w,C,u]),v=o.useCallback(e=>{f(!0),M(n=>n==null?void 0:n.filter(i=>i.material.id!==e))},[]),L=o.useMemo(()=>{return a.size?de(v,r,a,e):[];function e(n,i){f(!0),l.set(n,i)}},[a,l,v,r]),q=o.useCallback(()=>{if(m!=null&&m.some(e=>e.price<=0&&!l.get(e.material.id))){H.show({color:"red.5",message:r("Please input price for all materials")});return}J.openConfirmModal({title:r("Update changes"),children:t.jsx(T,{size:"sm",children:r("Are you sure to save changes?")}),labels:{confirm:"OK",cancel:r("Cancel")},onConfirm:async()=>{m&&(await ne({action:Q.UPDATE_SUPPLIER_MATERIAL,params:{supplierId:p,materials:m.map(e=>({materialId:e.material.id,price:l.get(e.material.id)??e.price}))},options:{toastMessage:r("Your changes have been saved")}}),f(!1),A())}})},[A,m,l,p,r]),K=o.useCallback(e=>{_(n=>n!==e?(S(""),e||""):n)},[]),V=o.useCallback(()=>{S(""),_(""),k(""),f(!1)},[k]);return!m||!w.length?t.jsx(t.Fragment,{}):t.jsx(b,{children:t.jsxs(b,{w:"100%",pb:10,children:[t.jsxs(j,{w:"100%",align:"center",justify:"space-between",children:[t.jsxs(T,{className:"c-catering-font-bold",size:"2rem",children:[(s==null?void 0:s.name)||"N/A"," - ",r("Supplier supplied material")]}),t.jsx(N,{disabled:!d,onClick:q,children:r("Save")})]}),t.jsxs(I,{mt:10,children:[t.jsx(I.Col,{span:9,children:E.size&&t.jsx(ee,{hasUpdateColumn:!1,hasOrderColumn:!0,columns:L,data:m})}),t.jsxs(I.Col,{span:3,className:"c-catering-bdr-box",children:[t.jsx(j,{justify:"end",align:"center",mb:"1rem",children:t.jsx($,{value:u,label:r("Material type"),w:"20vw",options:O,onChange:K},u)}),u&&t.jsx(j,{justify:"end",align:"center",mb:"1rem",children:t.jsx($,{label:r("Material group"),value:C,w:"20vw",options:G,onChange:S},u)}),t.jsx(j,{justify:"end",align:"center",mb:"1rem",children:t.jsx(re,{label:r("Material name"),w:"20vw",onEnter:k,data:R,onChange:B})}),t.jsx(b,{ta:"right",children:t.jsx(N,{disabled:!u,onClick:V,children:r("Clear")})}),t.jsx(pe,{h:"80vh",children:U.map(e=>{const n=m.some(W=>W.material.id===e.id),i=e.others.type,y=n?ce:ue;return t.jsx(b,{style:{cursor:"pointer",borderRadius:"5px"},bg:n?"primary.4":void 0,className:"c-catering-hover-bg",w:"100%",p:10,mb:4,onClick:()=>{n?v(e.id):F(e.id,a)},children:t.jsxs(j,{gap:5,children:[t.jsx(y,{}),t.jsxs("span",{style:{fontSize:".8rem"},children:[e.name," ",t.jsxs("span",{children:["(",r(`materials.type.${i}`),")"]})]})]})},e.id)})})]})]})]})})};export{Ie as default};
