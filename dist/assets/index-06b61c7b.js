import{p as L,c as O,t as G,R as S,B as K,v as W,x as k,y as Q,w as Z,C as t,Q as V,S as j,r as p,W as m,D as v,Z as _,M as H}from"./index-344213bf.js";import{A as J,D as X}from"./index-8981d1d4.js";import{u as Y}from"./index-970177b3.js";import{F as P,u as I}from"./useTranslation-e97efc14.js";import{u as ee}from"./supplier.store-70329809.js";import{s as R}from"./event-8c96bde5.js";import{c as z}from"./createReactComponent-9318f0fb.js";import{T as b}from"./Text-bc00d881.js";import{P as D,i as F}from"./index-2058cee8.js";import{c as B}from"./index-b822ee52.js";import{u as T}from"./use-form-0557ef85.js";import{T as i}from"./TextInput-028a1133.js";import{i as x}from"./is-not-empty-01b37365.js";import{S as re}from"./Stack-34296739.js";import"./Table-07bffc10.js";import"./Popover-378390b2.js";var q={root:"m-347db0ec","root--dot":"m-fbd81e3d",label:"m-5add502a",section:"m-91fdda9b"};const te={},ae=W((r,{radius:a,color:e,gradient:s,variant:o,size:n})=>{const l=r.variantColorResolver({color:e||r.primaryColor,theme:r,gradient:s,variant:o||"filled"});return{root:{"--badge-height":k(n,"badge-height"),"--badge-padding-x":k(n,"badge-padding-x"),"--badge-fz":k(n,"badge-fz"),"--badge-radius":a===void 0?void 0:Q(a),"--badge-bg":e||o?l.background:void 0,"--badge-color":e||o?l.color:void 0,"--badge-bd":e||o?l.border:void 0,"--badge-dot-color":o==="dot"?Z(e,r):void 0}}}),y=L((r,a)=>{const e=O("Badge",te,r),{classNames:s,className:o,style:n,styles:l,unstyled:d,vars:C,radius:w,color:A,gradient:M,leftSection:h,rightSection:g,children:c,variant:E,fullWidth:U,...$}=e,f=G({name:"Badge",props:e,classes:q,className:o,style:n,classNames:s,styles:l,unstyled:d,vars:C,varsResolver:ae});return S.createElement(K,{variant:E,mod:{block:U},...f("root",{variant:E}),ref:a,...$},h&&S.createElement("span",{...f("section"),"data-position":"left"},h),S.createElement("span",{...f("label")},c),g&&S.createElement("span",{...f("section"),"data-position":"right"},g))});y.classes=q;y.displayName="@mantine/core/Badge";var se=z("brand-itch","IconBrandItch",[["path",{d:"M2 7v1c0 1.087 1.078 2 2 2c1.107 0 2 -.91 2 -2c0 1.09 .893 2 2 2s2 -.91 2 -2c0 1.09 .893 2 2 2s2 -.91 2 -2c0 1.09 .893 2 2 2s2 -.91 2 -2c0 1.09 .893 2 2 2c.922 0 2 -.913 2 -2v-1c-.009 -.275 -.538 -.964 -1.588 -2.068a3 3 0 0 0 -2.174 -.932h-12.476a3 3 0 0 0 -2.174 .932c-1.05 1.104 -1.58 1.793 -1.588 2.068z",key:"svg-0"}],["path",{d:"M4 10c-.117 6.28 .154 9.765 .814 10.456c1.534 .367 4.355 .535 7.186 .536c2.83 -.001 5.652 -.169 7.186 -.536c.99 -1.037 .898 -9.559 .814 -10.456",key:"svg-1"}],["path",{d:"M10 16l2 -2l2 2",key:"svg-2"}],["path",{d:"M12 14v4",key:"svg-3"}]]),oe=z("shopping-cart","IconShoppingCart",[["path",{d:"M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-0"}],["path",{d:"M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M17 17h-11v-14h-2",key:"svg-2"}],["path",{d:"M6 5l14 1l-1 7h-13",key:"svg-3"}]]);const ne=(r,a)=>[{key:"name",header:r("Supplier name"),width:"20%"},{key:"code",header:r("Supplier code"),width:"10%"},{key:"pic",header:r("Supplier PIC"),width:"10%",renderCell:(e,s)=>{var o;return`${((o=s.others)==null?void 0:o.contact)||"-"}`}},{key:"contact",header:r("Supplier contact"),width:"15%",renderCell:(e,s)=>{var l,d;const o=((l=s.others)==null?void 0:l.email)||"Email: N/A",n=((d=s.others)==null?void 0:d.phone)||"Phone: N/A";return t.jsxs(t.Fragment,{children:[o,t.jsx("br",{}),n]})}},{key:"catering",header:r("Supplier total catering"),width:"10%",renderCell:(e,s)=>{const o=Math.floor(Math.random()*10)>5?1:0;return t.jsx(y,{color:o>0?"orange.6":"gray",p:10,onClick:n=>{R(n);const l=`/supplier-management/catering/${s.id}`;a(l)},children:t.jsxs(P,{align:"center",p:4,children:[t.jsx(se,{size:20})," ",t.jsxs(b,{fw:800,fz:"1rem",children:["(",o,")"]})]})})}},{key:"material",header:r("Supplier material"),width:"10%",renderCell:(e,s)=>{const o=s.supplierMaterials.length;return t.jsx(y,{color:o>0?"orange.6":"gray",p:10,onClick:n=>{R(n);const l=`/supplier-management/material/${s.id}`;a(l)},children:t.jsxs(P,{align:"center",p:4,children:[t.jsx(oe,{size:20})," ",t.jsxs(b,{fw:800,fz:"1rem",children:["(",o,")"]})]})})}}],{request:le}=V[j.ADD_SUPPLIER].schema,ie={name:"",code:"",others:{email:"",phone:"",contact:"",address:""}},ce=({initialValues:r,reOpen:a})=>{const e=I(),s=T({validate:pe(e),initialValues:r??ie}),o=p.useCallback(n=>{m.openConfirmModal({title:e("Add user"),children:t.jsx(b,{size:"sm",children:e("Are you sure you want to add new supplier?")}),labels:{confirm:"OK",cancel:e("Cancel")},onCancel:()=>{m.closeAll(),a&&a(n)},onConfirm:async()=>{await B({action:j.ADD_SUPPLIER,params:le.parse(n),options:{toastMessage:e("Add supplier successfully"),reloadOnSuccess:!0}})}})},[a,e]);return t.jsxs("form",{className:"c-catering-form-wrapper",onSubmit:s.onSubmit(o),children:[t.jsx(i,{w:"100%",withAsterisk:!0,label:e("Supplier name"),placeholder:e("Supplier name"),...s.getInputProps("name")}),t.jsx(i,{w:"100%",withAsterisk:!0,label:e("Supplier code"),placeholder:e("Supplier code"),...s.getInputProps("code")}),t.jsx(i,{w:"100%",withAsterisk:!0,label:e("Supplier contact"),placeholder:e("Supplier contact"),...s.getInputProps("others.contact")}),t.jsx(i,{w:"100%",label:e("Supplier email"),placeholder:e("Supplier email"),...s.getInputProps("others.email")}),t.jsx(D,{w:"100%",label:e("Supplier phone"),placeholder:e("Supplier phone"),onChangeValue:n=>s.setFieldValue("phone",n),...s.getInputProps("others.phone")}),t.jsx(i,{w:"100%",label:e("Supplier address"),placeholder:e("Supplier address"),...s.getInputProps("others.address")}),t.jsx(v,{type:"submit",children:e("Add")})]})};function pe(r){return{name:x(r("field is required")),code:x(r("field is required")),"others.phone":a=>{if(a&&(typeof a!="string"||a&&!F(a)))return r("Invalid phone number")},"others.email":a=>{if(a)try{_.parse(a)}catch{return r("Invalid email")}}}}const{request:N}=V[j.UPDATE_SUPPLIER].schema,u="100%",de=({supplier:r,reOpen:a})=>{const e=I(),s=T({validate:ue(e),initialValues:{id:r.id,name:r.name||"",code:r.code||"",others:{email:r.others.email||"",phone:r.others.phone||"",contact:r.others.contact||"",address:r.others.address||""}}}),o=p.useCallback(n=>{m.openConfirmModal({title:e("Add user"),children:t.jsx(b,{size:"sm",children:e("Are you sure you want to add new supplier?")}),labels:{confirm:"OK",cancel:e("Cancel")},onCancel:()=>{m.closeAll();const l=N.parse(n);a&&a({...r,...l,others:l.others})},onConfirm:async()=>{await B({action:j.UPDATE_SUPPLIER,params:N.parse(n),options:{toastMessage:e("Update supplier successfully"),reloadOnSuccess:!0}})}})},[a,r,e]);return t.jsxs("form",{className:"c-catering-form-wrapper",onSubmit:s.onSubmit(o),children:[t.jsx(i,{w:u,withAsterisk:!0,label:e("Supplier name"),placeholder:e("Supplier name"),...s.getInputProps("name")}),t.jsx(i,{w:u,withAsterisk:!0,label:e("Supplier code"),placeholder:e("Supplier code"),...s.getInputProps("code")}),t.jsx(i,{w:u,withAsterisk:!0,label:e("Supplier contact"),placeholder:e("Supplier contact"),...s.getInputProps("others.contact")}),t.jsx(i,{w:u,label:e("Supplier email"),placeholder:e("Supplier email"),...s.getInputProps("others.email")}),t.jsx(D,{w:u,label:e("Supplier phone"),placeholder:e("Supplier phone"),onChangeValue:n=>s.setFieldValue("others.phone",n),...s.getInputProps("others.phone")}),t.jsx(i,{w:u,label:e("Supplier address"),placeholder:e("Supplier address"),...s.getInputProps("others.address")}),t.jsx(v,{type:"submit",children:e("Save")})]})};function ue(r){return{name:x(r("field is required")),code:x(r("field is required")),"others.phone":a=>{if(a&&(typeof a!="string"||a&&!F(a)))return r("Invalid phone number")},"others.email":a=>{if(a)try{_.parse(a)}catch{return r("Invalid email")}}}}const Me=()=>{const r=I(),a=H(),e=ee(),[s,o]=p.useState(1),n=p.useMemo(()=>ne(r,a),[r,a]),l=p.useCallback(async()=>(await e.reload(),Array.from(e.suppliers.values())),[e]),{data:d,names:C,filter:w,change:A}=Y({reload:l}),M=p.useCallback(c=>{o(1),w(c)},[w]),h=p.useCallback(c=>{m.open({title:r("Add supplier"),classNames:{title:"c-catering-font-bold"},centered:!0,size:"lg",children:t.jsx(ce,{initialValues:c,reOpen:h})})},[r]),g=p.useCallback(c=>{m.open({title:c.name,classNames:{title:"c-catering-font-bold"},centered:!0,size:"lg",children:t.jsx(de,{supplier:c,reOpen:g})})},[]);return t.jsxs(re,{gap:10,children:[t.jsxs(P,{justify:"end",align:"center",gap:10,children:[t.jsx(J,{w:"20vw",onEnter:M,data:C,onChange:A}),t.jsx(v,{w:100,onClick:()=>h(),children:r("Add")})]}),t.jsx(X,{onRowClick:g,page:s,limit:10,isPaginated:!0,hasOrderColumn:!0,columns:n,data:d,onChangePage:o})]})};export{Me as default};
