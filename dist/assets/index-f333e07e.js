import{C as e,D as A,r as l,a4 as E,W as G,S as P,B as C}from"./index-344213bf.js";import{u as O,D as R,A as T}from"./index-8981d1d4.js";import{b as U,u as J}from"./index-970177b3.js";import{u as K,l as L,F as I}from"./useTranslation-e97efc14.js";import{c as W}from"./index-b822ee52.js";import{u as Y}from"./catering.store-2a738656.js";import{u as q}from"./supplier.store-70329809.js";import{N as H}from"./NumberInput-c7b98c1d.js";import{T as k}from"./Text-bc00d881.js";import{G as j,I as Q}from"./IconCirclePlus-0cf0926b.js";import{S as V}from"./Table-07bffc10.js";import"./createReactComponent-9318f0fb.js";import"./Popover-378390b2.js";import"./get-sorted-breakpoints-92247a0e.js";const X=(c,a,d)=>[{key:"name",header:c("Catering name"),width:"35%",textAlign:"left",renderCell(n,r){return e.jsx("span",{children:r.name||"-"})}},{key:"address",header:c("Catering address"),width:"35%",renderCell(n,r){return e.jsx("span",{children:(r==null?void 0:r.others.address)||"N/A"})}},{key:"addition-fee",width:"300px",header:c("Supplier catering addition fee"),renderCell(n,r){const o=()=>{const[p,f]=l.useState(r.price||0);return e.jsx(H,{suffix:" Ä‘",step:1e3,onChange:u=>{const m=Z(u);f(m),d((r==null?void 0:r.id)||"",m)},onBlur:()=>{p&&d((r==null?void 0:r.id)||"",p)},thousandSeparator:".",decimalSeparator:",",value:p})};return e.jsx(o,{})}},{key:"remove",style:{flexGrow:1},textAlign:{cell:"right"},renderCell(n,r){return e.jsx(A,{mr:10,size:"compact-xs",onClick:a.bind(null,r.id),children:c("Remove")})}}];function Z(c){let a=parseInt(c.toString().replace(/\./g,"").replace(/,/g,"."));return(isNaN(a)||a<0)&&(a=0),a}const me=()=>{const{reload:c,caterings:a}=Y(),{supplierId:d}=E(),n=K(),{set:r}=q(),[o,p]=l.useState(),[f,u]=l.useState(!1),[m,h]=l.useState([]),[g]=l.useState(new Map),x=l.useCallback(async()=>{var s;if(!d)return;await c();const t=await U(d);t&&(r([t]),p(t),L.info("supplier",JSON.stringify(t.others.caterings,null,2)),h((s=t.others.caterings)==null?void 0:s.map(i=>{if(a.has(i.cateringId))return{...a.get(i.cateringId),price:i.additionalFee}}).filter(Boolean)))},[d,c,r,a]);O(x);const N=l.useCallback(()=>a.size?Array.from(a.values()):[],[a]),{data:S,records:v,names:z,filter:B,change:F}=J({reload:N}),_=l.useCallback((t,s)=>{u(!0),h(i=>{const y=s.get(t);return y?[...i||[],y]:i})},[]),b=l.useCallback(t=>{u(!0),h(s=>s==null?void 0:s.filter(i=>i.id!==t))},[]),M=l.useMemo(()=>{return X(n,b,t);function t(s,i){g.set(s,i),u(!0)}},[g,b,n]),D=l.useCallback(()=>{G.openConfirmModal({title:n("Update changes"),children:e.jsx(k,{size:"sm",children:n("Are you sure to save changes?")}),labels:{confirm:"OK",cancel:n("Cancel")},onConfirm:async()=>{if(!o)return;const t=o;delete t.others,delete t.id;const s=await W({action:P.UPDATE_SUPPLIER,params:{...t,id:d,others:{...o==null?void 0:o.others,caterings:m.map(i=>({cateringId:i.id,additionalFee:g.get(i.id)??i.price??0}))}},options:{toastMessage:n("Your changes have been saved")}});s!=null&&s.success&&(u(!1),x())}})},[m,g,x,o,d,n]);return!a.size||!S.length?e.jsx(e.Fragment,{}):e.jsx(C,{children:e.jsxs(C,{w:"100%",pb:10,children:[e.jsxs(I,{w:"100%",align:"center",justify:"space-between",children:[e.jsxs(k,{className:"c-catering-font-bold",size:"2rem",children:[(o==null?void 0:o.name)||"N/A"," - ",n("Supplier supplied catering")]}),e.jsx(A,{disabled:!f,onClick:D,children:n("Save")})]}),e.jsxs(j,{mt:10,children:[e.jsx(j.Col,{span:9,children:v.size&&e.jsx(R,{hasUpdateColumn:!1,hasOrderColumn:!0,columns:M,data:m})}),e.jsxs(j.Col,{span:3,className:"c-catering-bdr-box",children:[e.jsx(T,{mr:10,label:n("Catering name"),onEnter:B,data:z,onChange:F}),e.jsx(V,{h:"80vh",children:S.map(t=>{const s=Q;return e.jsx(C,{style:{cursor:"pointer",borderRadius:"5px"},bg:void 0,className:"c-catering-hover-bg",w:"100%",p:10,mb:4,onClick:()=>{_(t.id,a)},children:e.jsxs(I,{gap:5,children:[e.jsx(s,{}),e.jsx("span",{style:{fontSize:".8rem"},children:t.name})]})},t.id)})})]})]})]})})};export{me as default};
