import{Q as z,S as w,r as f,V as E,W as M,C as n,B as P,D as v,U as S}from"./index-344213bf.js";import{u as $,F as _}from"./useTranslation-e97efc14.js";import{c as B}from"./index-b822ee52.js";import{c as p}from"./array-59786a0a.js";import{T as y}from"./Text-bc00d881.js";import{S as V}from"./Stack-34296739.js";import{S as F,T as m}from"./Table-07bffc10.js";import{T as b}from"./Tooltip-706963bd.js";import{c as A}from"./createReactComponent-9318f0fb.js";import{T as k}from"./TextInput-028a1133.js";import{N as K}from"./NumberInput-c7b98c1d.js";var O=A("code-minus","IconCodeMinus",[["path",{d:"M9 12h6",key:"svg-0"}],["path",{d:"M6 19a2 2 0 0 1 -2 -2v-4l-1 -1l1 -1v-4a2 2 0 0 1 2 -2",key:"svg-1"}],["path",{d:"M18 19a2 2 0 0 0 2 -2v-4l1 -1l-1 -1v-4a2 2 0 0 0 -2 -2",key:"svg-2"}]]),L=A("code-plus","IconCodePlus",[["path",{d:"M9 12h6",key:"svg-0"}],["path",{d:"M12 9v6",key:"svg-1"}],["path",{d:"M6 19a2 2 0 0 1 -2 -2v-4l-1 -1l1 -1v-4a2 2 0 0 1 2 -2",key:"svg-2"}],["path",{d:"M18 19a2 2 0 0 0 2 -2v-4l1 -1l-1 -1v-4a2 2 0 0 0 -2 -2",key:"svg-3"}]]);function N(e){var c,o,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var u=e.length;for(c=0;c<u;c++)e[c]&&(o=N(e[c]))&&(s&&(s+=" "),s+=o)}else for(o in e)e[o]&&(s&&(s+=" "),s+=o);return s}function Q(){for(var e,c,o=0,s="",u=arguments.length;o<u;o++)(e=arguments[o])&&(c=N(e))&&(s&&(s+=" "),s+=c);return s}const W="_container_3dqki_1",Y="_header_3dqki_8",G="_scrolled_3dqki_26",H="_row_3dqki_30",T={container:W,header:Y,scrolled:G,row:H},{request:J}=z[w.UPDATE_UNITS].schema;J.transform(e=>e[0]);const he=()=>{const e=$(),[c,o]=f.useState(!1),{units:s,loadMetaData:u}=E(),[l,r]=f.useState(0),[i,t]=f.useState(),[a,d]=f.useState(),[g,x]=f.useState(0);f.useEffect(()=>{s.length&&t(p(s))},[s]);const C=f.useMemo(()=>ee(g,s,e),[g,s,e]),I=f.useMemo(()=>Z(i||[],C,t,d,e),[C,i,e]),U=f.useMemo(()=>X(C,x,e),[C,e]),R=f.useCallback(()=>{M.openConfirmModal({title:e("Update changes"),children:n.jsx(y,{size:"sm",children:e("Are you sure to save changes?")}),labels:{confirm:"OK",cancel:e("Cancel")},onConfirm:()=>{const j=a==null?void 0:a.filter(h=>!!h.name);B({action:w.UPDATE_UNITS,params:a==null?void 0:a.filter(h=>!!h.name),options:{toastMessage:e("Your changes have been saved")}}).then(()=>{t(j),r(l+1),d(void 0),u()})}})},[l,u,e,a]),D=f.useCallback(()=>{M.openConfirmModal({title:e("Reset changes"),children:n.jsx(y,{size:"sm",children:e("Are you sure you want to reset changes?")}),labels:{confirm:"OK",cancel:e("Cancel")},onConfirm:()=>{x(0),t(p(s)),d(void 0),r(l+1)}})},[l,e,s]),q=f.useCallback(()=>{const j={id:"",name:"",units:[],converters:[]};d(h=>(h||(h=p(i)||[]),h.push(j),[...h])),t(h=>(h||(h=[]),h.push(j),[...h]))},[i]);return n.jsxs(V,{gap:10,children:[n.jsxs(P,{ta:"right",pr:10,children:[n.jsxs("div",{children:["list: ",i==null?void 0:i[0].name]}),n.jsxs("div",{children:["updated: ",(a==null?void 0:a[0].name)||"-"]}),n.jsx(v,{variant:"outline",ml:10,w:100,onClick:q,children:e("Add")}),n.jsx(v,{variant:"light",ml:10,w:100,onClick:D,disabled:!a,children:e("Reset")}),n.jsx(v,{color:"orange",ml:10,w:100,onClick:R,disabled:!a,children:e("Save")})]}),n.jsx(F,{h:"80vh",className:T.container,onScrollPositionChange:({y:j})=>o(j!==0),children:n.jsxs(m,{children:[n.jsx(m.Thead,{className:Q(T.header,{[T.scrolled]:c}),children:U}),n.jsx(m.Tbody,{children:I})]},l)})]})};function X(e,c,o){return n.jsxs(m.Tr,{children:[n.jsx(m.Th,{children:"#"}),n.jsx(m.Th,{children:o("Unit")}),e.map(({header:s,last:u},l)=>n.jsx(m.Th,{children:n.jsxs(_,{justify:"space-between",align:"center",pr:10,children:[s,u&&n.jsxs(_,{children:[n.jsx(S,{className:"c-catering-flex-align-center",onClick:()=>c(r=>r+1),children:n.jsx(b,{label:o("Add column"),children:n.jsx(L,{size:20})})}),n.jsx(S,{className:"c-catering-flex-align-center",onClick:()=>c(r=>r-1),children:n.jsx(b,{label:o("Remove column"),children:n.jsx(O,{size:20})})})]})]})},l)),n.jsx(m.Th,{})]})}function Z(e,c,o,s,u){function l(r,i,t,a){s(d=>(d||(d=p(e)),t==="name"&&(d[r].name=a.toString()),t==="units"&&(d[r].units[i-1]=a.toString()),t==="converters"&&(d[r].converters[i-2]=parseInt(a.toString())),[...d]))}return e.map((r,i)=>n.jsxs(m.Tr,{className:T.row,children:[n.jsx(m.Td,{children:i+1}),n.jsx(m.Td,{children:n.jsx(k,{defaultValue:r.name,onChange:t=>{l(i,0,"name",t.target.value)}})}),c.map(({type:t,idx:a},d)=>n.jsx(m.Td,{children:t==="unit"?n.jsx(k,{defaultValue:r.units[a-1],onChange:g=>{l(i,a,"units",g.target.value)}}):n.jsx(K,{defaultValue:r.converters[a-2],onChange:g=>{const x=parseInt(g.toString());isNaN(x)||l(i,a,"converters",x)}})},d)),n.jsx(m.Td,{children:n.jsx(v,{size:"compact-xs",variant:"light",color:"red",ml:10,w:100,onClick:()=>{o(t=>(t||(t=[]),t.splice(i,1),[...t])),s(t=>(t||(t=p(e)),t.splice(i,1),[...t]))},children:u("Remove")})})]},r.name))}function ee(e,c,o){const s=2*e+-1+2*Math.max(...c.map(u=>u.units.length),0);return Array.from({length:s},(u,l)=>{const r=1+Math.floor((1+l)/2);return l%2===0?{header:`${o("Unit")} ${r}`,type:"unit",idx:r,last:l===s-1}:{header:`${o("Converter")} ${r-1}â†’${r}`,type:"converter",idx:r}})}export{he as default};
